---
title: R codes for data analysis
author: Bin Xu
date: '2021-07-28'
slug: r-codes-for-data-analysis
categories:
  - 统计
tags:
  - R
  - 数据分析
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="生存分析" class="section level2">
<h2>生存分析</h2>
<pre class="r"><code># 生存数据示例
library(survival)
library(survminer)

OS &lt;- Surv(time = df$OS, event = df$OS_status)
RFS &lt;- Surv(time = df$RFS, event = df$RFS_status)</code></pre>
<div id="画生存曲线" class="section level3">
<h3>画生存曲线</h3>
<pre class="r"><code>library(survival)

ggsurvplot(fit = survfit(OS ~ 1, data = df), 
           palette = &quot;jco&quot;, # or palette = c(&quot;#E7B800&quot;, &quot;#2E9FDF&quot;),
           
           # Allowed values are one of c(&quot;top&quot;, &quot;bottom&quot;, &quot;left&quot;, &quot;right&quot;, &quot;none&quot;). 
           # Legend position can be also specified using a numeric vector c(x, y). 
           # In this case it is possible to position the legend inside the plotting area. 
           # x and y are the coordinates of the legend box. Their values should be between 0 and 1.
           legend = &quot;none&quot;, 
           legend.title = &quot;group&quot;,
           legend.labs = c(&quot;DCP responder&quot;, &quot;DCP nonresponder&quot;),
           
           pval = T, # 也可以直接指定要显示的p value
           # numeric vector, of length 2, specifying the x and y coordinates of the p-value. 
           # Default values are NULL.
           pval.coord = c(50, 1), 
           
           conf.int = F,
           
           surv.median.line = &quot;hv&quot;,
           
           # title = &quot;Progress-Free Survival&quot;,
           ylab = &quot;Overall Survival&quot;,
           xlab = &quot;Months&quot;,
           
           # axes.offset = F, # Default is TRUE. If FALSE, set the plot axes to start at the origin.
           ylim = c(0,1),
           break.y.by = 0.2,
           # surv.scale = &quot;percent&quot;, 
           xlim = c(0, 60),
           break.x.by = 12,
           # xscale = &quot;d_m&quot;, # will transform labels from days to months
           
           risk.table = T,
           risk.table.title = &quot;Number at Risk&quot;,
           risk.table.y.text = F,
           risk.table.y.text.col = T,
           risk.table.height = 0.15,
           ggtheme = theme_survminer(base_size = 6),
           tables.theme = theme_cleantable(base_size = 6))</code></pre>
</div>
<div id="批量单因素logrank函数" class="section level3">
<h3>批量单因素logrank函数</h3>
<pre class="r"><code>uni_logrank &lt;- function(gvar, surv, df) {
  temp &lt;- survdiff(as.formula(paste0(surv, &quot; ~ &quot;, gvar)), 
                   data = df)
  p.value &lt;- round(broom::glance(temp)$p.value, 3)
  return(p.value)
}

# OS
uni_logrank_batch_OS &lt;- sapply(vars, uni_logrank, &quot;OS&quot;, df)
uni_logrank_batch_OS[uni_logrank_batch_OS &lt; 0.05]

# RFS
uni_logrank_batch_RFS &lt;- sapply(vars, uni_logrank, &quot;RFS&quot;, df)
uni_logrank_batch_RFS[uni_logrank_batch_RFS &lt; 0.05]</code></pre>
</div>
</div>
